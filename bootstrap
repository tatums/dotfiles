#!/usr/bin/env bash
set -euo pipefail

dir="$HOME/dotfiles"
olddir="$HOME/dotfiles_old"

files=(
  digrc
  gemrc
  gitconfig
  gitignore
  shell_aliases
  zshenv
  zprofile
  zshrc
)

echo "-- Creating $olddir for backup of any existing dotfiles"
mkdir -p "$olddir"

echo "-- Changing to the $dir directory"
cd "$dir"

for file in "${files[@]}"; do
  src="$dir/$file"
  dest="$HOME/.$file"

  echo "---- Processing .$file"

  # Backup existing file if it exists and is not the correct symlink
  if [ -e "$dest" ] && [ ! -L "$dest" ]; then
    echo "------ Backing up existing .$file to $olddir"
    mv "$dest" "$olddir/"
  fi

  # Create or update symlink
  echo "------ Linking $src â†’ $dest"
  ln -snf "$src" "$dest"
done
